<!-- Polymer dependencies -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner-lite.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../../web-components/uxph-conference-2017-behaviors/uxph-conference-2017-behaviors.html">
<link rel="import" href="../../web-components/uxph-conference-2017-footer/uxph-conference-2017-footer.html">

<!-- Style dependency -->
<link rel="import" href="home-page-style.html">

<dom-module id="home-page">
  <template>
    <style is="custom-style" include="home-page-style iron-flex iron-flex-alignment iron-flex-factors">
      :host {
        display: block;
      }
    </style>

    <firebase-document 
        path="[[_speakerList]]"
        data="{{_speakersLive}}"></firebase-document>

    <app-indexeddb-mirror
        key="speakerList"
        data="{{_speakersLive}}"
        persisted-data="{{_speakers}}"></app-indexeddb-mirror>

    <firebase-document 
        path="[[_pledgeList]]"
        data="{{_pledgesLive}}"></firebase-document>

    <app-indexeddb-mirror
        key="pledgesList"
        data="{{_pledgesLive}}"
        persisted-data="{{_pledges}}"></app-indexeddb-mirror>

    <div class="horizontal layout wrap">
      <div class="flex-4">
        <div class="main-background">
          <a href="/">
            <img src="/images/assets/logo.png" class="logo">
          </a>
          
          <div class="foreground-title">
            <h1>Design for a better Philippines</h1>
          </div>  
        </div>

        <div class="horizontal layout wrap">
          <div class="flex-3 main-content">
            <p class="text-content">
              We would like to bring experts on experience design and learn better 
              interactions, visuals, product,  customer services, government services and startup UX.
            </p>

            <p class="text-content">
              Letâ€™s make it happen.
            </p>
            
            <p class="text-content">
              We are are group of UX professionals organizing a conference on experience and design on <b>May 19-20,2016</b>.
            </p>

            <p class="text-content">
              We would like know if you would like to be a part of it. 
              Join us by supporting and pledging to this event. 
              If you pledge, we will survey you venue options.
            </p>
            
            <p class="text-content">
              The following international speakers have expressed interest in joining  this conference.
            </p>
            
            <div class="speaker-list">
              <template is="dom-repeat" items="[[speakers]]" sort="_sorter">
                <div class="horizontal layout wrap speaker-item">
                  <iron-image class="speaker-avatar" src$="[[item.src]]" preload fade></iron-image>
                  <div class="flex speaker-content"> 
                    <h3>[[item.name]]</h3>
                    <p class="speaker-body">
                      [[item.description]]
                    </p>  
                  </div>
                </div>
              </template>
              
              <template is="dom-if" if="[[!_checkEmptyArray(speakers)]]">                             
                <paper-spinner-lite active></paper-spinner-lite>
              </template>
            </div>
          </div>
          <!-- FLEX SPACER -->
          <div class="flex spacer"></div>
        </div>     
      </div>


      <!-- SIDE WINDOW -->
      <paper-material class="flex-2 side-window">
        <div class="side-window-title">
          <h2>Support us</h2>
          <h4>Rewards</h4>
        </div>  
        
        <template is="dom-repeat" items="[[pledges]]" sort="_sorter">
          <a class="pledge-item-anchor" href="/support/[[item.$key]]">
            <paper-material class="pledge-item pledge-picked">              
              <p class="pledge-description">
                <b class="pledge-title">[[item.title]]</b><br/>
                [[item.description]]
              </p>
            </paper-material>  
          </a>
        </template>

        <template is="dom-if" if="[[!_checkEmptyArray(pledges)]]">  
          <div class="horizontal layout">
            <div class="flex"></div>
            <paper-spinner-lite active></paper-spinner-lite>
            <div class="flex-3"></div>
          </div>                           
          
        </template>

        <div class="submit-area">
          <paper-button raised on-tap="_openSupportDialog">
            Support
          </paper-button>   
        </div>
      </paper-material>
    </div>

    <uxph-conference-2017-footer></uxph-conference-2017-footer>

    <paper-dialog 
        id="support-dialog" 
        entry-animation="scale-up-animation" 
        exit-animation="fade-out-animation" with-backdrop>
      <h4>Please pick a pledge</h4>

      <div>
        <template is="dom-repeat" items="[[pledges]]">
          <a class="pledge-item-anchor" href="/support/[[item.$key]]" on-tap="_closeSupportDialog">
            <paper-material class="pledge-item pledge-picked">              
              <p class="pledge-description">
                <b class="pledge-title">[[item.title]]</b><br/>
                <span class="pledge-body">[[item.description]]</span>
              </p>
            </paper-material>  
          </a>
        </template>

        <template is="dom-if" if="[[!_checkEmptyArray(pledges)]]">                            
          <paper-spinner-lite active></paper-spinner-lite>
        </template>
      </div>
      

    </paper-dialog>
  </template>

  <script>
    Polymer({
      is: 'home-page',

      behaviors: [
        Polymer.UXPHConf2017Behavior
      ],

      _checkEmptyArray: function(a) {        
        return a && a.length > 0;
      },

      _sorter: function(i, j) {        
        Polymer.dom.flush();
        return i.index > j.index
      },

      _openSupportDialog: function() {
        this.$$('#support-dialog').open();
      },

      _closeSupportDialog: function() {
        this.$$('#support-dialog').close();
      }
    });
  </script>
</dom-module>
