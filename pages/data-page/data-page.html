<!-- Polymer dependencies -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../web-components/uxph-conference-2017-behaviors/uxph-conference-2017-behaviors.html">
<link rel="import" href="../../web-components/uxph-conference-2017-footer/uxph-conference-2017-footer.html">
<link rel="import" href="../../web-components/uxph-conference-2017-pledge-item/uxph-conference-2017-pledge-item.html">


<!-- Style dependency -->
<link rel="import" href="data-page-style.html">

<dom-module id="data-page">
  <template>
    <style is="custom-style" include="data-page-style iron-flex iron-flex-alignment iron-flex-factors">
      :host {
        display: block;
      }
    </style>

    <firebase-query
        path="[[_contactInfo]]" data="{{contacts}}"></firebase-query>

    <firebase-document
        path="[[_pledgeSurvey]]" data="{{pledgesObj}}"></firebase-document>


    Submitted Emails: [[_contactsNumber(contacts, contacts.splices)]]<br/>
    <template is="dom-repeat" items="[[contacts]]" as="contact">
      <template is="dom-if" if="[[_checkEmail(contact.email, contact.$key)]]">
        [[contact.email]] - [[contact.fullName]] - [[_returnPledge(pledgesObj, contact.$key)]]<br/>
      </template>
    </template>
    <br/>
    <hr>
    Submitted Emails<br/>
    Pin: [[_pledgeNumberSubmitted(pledgesObj, 'pin')]]<br/>
    Sticker: [[_pledgeNumberSubmitted(pledgesObj, 'sticker')]]<br/>
    Shirt: [[_pledgeNumberSubmitted(pledgesObj, 'shirt')]]<br/>
    Early Bird: [[_pledgeNumberSubmitted(pledgesObj, 'early-bird')]]<br/>
    Early Bird x2: [[_pledgeNumberSubmitted(pledgesObj, 'early-bird-2x')]]<br/><br/>

    <hr>
    Overall
    Pin: [[_pledgeNumber(pledgesObj, 'pin')]]<br/>
    Sticker: [[_pledgeNumber(pledgesObj, 'sticker')]]<br/>
    Shirt: [[_pledgeNumber(pledgesObj, 'shirt')]]<br/>
    Early Bird: [[_pledgeNumber(pledgesObj, 'early-bird')]]<br/>
    Early Bird x2: [[_pledgeNumber(pledgesObj, 'early-bird-2x')]]
  </template>

  <script>
    Polymer({
      is: 'data-page',

      __dummy: [],

      __submitted: [],

      behaviors: [
        Polymer.UXPHConf2017Behavior
      ],

      _checkEmail: function(email, key) {
        if (email === 'tjmonsi@gmail.com' && key) this.__dummy.push(key)
        if (email && email !== 'tjmonsi@gmail.com' && key) this.__submitted.push(key)
        return email && email !== 'tjmonsi@gmail.com'
      },

      _returnPledge: function (pledges, key) {
        if (pledges[key]) {
          return pledges[key].pledge
        }

      },

      _contactsNumber: function(contacts) {
        var count = 0;
        for (var i in contacts) {
          // console.log(contacts[i].email)
          if (this._checkEmail(contacts[i].email)) {
            count++
          }
        }
        return count;
      },

      _pledgeNumberSubmitted: function(pledges, key) {
        var count = 0;
        for (var i in pledges) {
          if (this.__dummy.indexOf(i) < 0) {
            if (this.__submitted.indexOf(i) >= 0) {
              if (pledges[i]) {
                if (pledges[i].pledge === key) count++
              }
            }

          }
        }
        return count;
      },

      _pledgeNumber: function(pledges, key) {
        var count = 0;
        for (var i in pledges) {
          if (this.__dummy.indexOf(i) < 0) {
            if (pledges[i]) {
              if (pledges[i].pledge === key) count++
            }
          }
        }
        return count;
      }
    });
  </script>
</dom-module>
